{{- if .Values.ingresses }}
{{- range $ingress := .Values.ingresses}}
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: "{{ $.Release.Name }}-{{ $ingress.name }}"
  annotations:
    kubernetes.io/ingress.class: "nginx"
    {{- if $ingress.allowHttp }}
    kubernetes.io/ingress.allow-http: "true"
    {{- end }}
    {{- if $ingress.sslRedirect }}
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    {{- end }}
spec:
  {{- if $ingress.rules }}
  rules:
  {{- range $rule := $ingress.rules }}
  - host: "{{ $rule.host }}"
    # type: HTTP
    {{- if $rule.http }}
    http:
      paths:
      {{- range $path := $rule.http.paths }}
      - path: "{{ $path.path }}"
        backend:
          serviceName: "{{ $.Release.Name }}-{{ $path.backend.serviceSelector }}"
          servicePort: {{ $path.backend.servicePort }}
      {{- end }} # endforeach paths
    {{- end }} # endif rule.http
  {{- end }} # endforeach rule
  {{- end }} # endif rules
{{- end }} # endforeach ingress
{{- end }} # endif ingress
